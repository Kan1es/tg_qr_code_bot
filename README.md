# tg_qr_code_bot

Небольшой Telegram-бот на Python для генерации QR-кодов из ссылок с возможностью настройки цветов заливки и фона.

Этот README составлен на основе файлов репозитория:
- main.py — главный скрипт бота (реализация на aiogram)
- requirements.txt — зависимости
- .gitignore — исключаемые файлы/папки (включая .env)
- LICENSE — в репозитории лежит лицензия Apache License 2.0

---

## Функции
- Генерация QR-кода из URL (текст должен начинаться с http:// или https://)
- Настройка дизайна QR-кода командой `/design`:
  - ввод цвета заливки в HEX (напр. `#FF0000`)
  - ввод цвета фона в HEX (напр. `#FFFFFF`)
- Сброс пользовательских настроек — команда `/reset`
- Хранение настроек пользователей в памяти (временное, сбрасывается при перезапуске бота)
- Работа по polling (по умолчанию, через aiogram)

---

## Особенности реализации
- Бот написан с использованием aiogram v3.
- Файлы:
  - main.py — обработчики команд и логика генерации QR.
  - requirements.txt — перечислены необходимые пакеты.
- Генерация QR:
  - qrcode.QRCode(version=1, error_correction=ERROR_CORRECT_L, box_size=10, border=4)
  - По умолчанию: fill_color = `black`, back_color = `white` (можно менять через /design)
- Валидация цвета — функция is_valid_hex проверяет формат HEX (шестизначный).

Важно: main.py ожидает переменную окружения BOT_TOKEN. Если её нет — бот не запустится.

---

## Требования
- Python 3.8+
- Установленные зависимости (см. requirements.txt):
  - aiogram>=3.0.0
  - qrcode[pil]>=7.0
  - python-dotenv>=1.0.0
  - pillow>=10.0.0

---

## Установка и запуск

1. Клонируйте репозиторий:
```bash
git clone https://github.com/Kan1es/tg_qr_code_bot.git
cd tg_qr_code_bot
```

2. Создайте виртуальное окружение и установите зависимости:
```bash
python -m venv venv
# macOS / Linux
source venv/bin/activate
# Windows (PowerShell)
venv\Scripts\Activate.ps1

pip install -r requirements.txt
```

3. Создайте файл `.env` в корне репозитория и добавьте токен бота:
```
BOT_TOKEN=123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11
```
Примечание: основной код ожидает переменную окружения `BOT_TOKEN`. Не коммитьте `.env` — он указан в `.gitignore`.

4. Запустите бота:
```bash
python main.py
```

После запуска бот будет работать в режиме polling.

---

## Как пользоваться

- /start — получить приветственное сообщение и краткую инструкцию.
- /design — начать настройку дизайна QR-кода:
  1. Бот попросит ввести цвет заливки в HEX (пример: `#FF5733`).
  2. Затем попросит ввести цвет фона в HEX (пример: `#FFFFFF`).
  3. После этого бот перейдёт в режим ожидания URL.
- /reset — сбросить сохранённые настройки дизайна (для текущего пользователя).
- Отправьте ссылку, начинающуюся с `http://` или `https://`, — бот сгенерирует и пришлёт QR-код с подписью, показывающей текущие цвета.

Примеры:
- Отправили в чат `https://example.com` → получили PNG с QR-кодом.
- Последовательность: `/design` → `#FF0000` → `#FFFFFF` → `https://example.com` → QR в красном цвете на белом фоне.

---

## Ограничения и замечания
- Настройки пользователей хранятся в памяти (словарь user_settings). При перезапуске бота они теряются. Если нужно сохранять между перезапусками, добавьте простую БД (sqlite/Redis/файл).
- В обработчике текста считается URL только если текст начинается с `http://` или `https://`. Другие форматы не распознаются.
- Нет команды `/qr` в коде — генерация запускается при получении текста-ссылки.
- При больших объёмах запросов хранение изображений в памяти и одновременная генерация могут потребовать оптимизации.

---

## Безопасность
- Никогда не выкладывайте `BOT_TOKEN` публично.
- .gitignore уже содержит `.env`, venv и другие временные/локальные файлы.

---

## Отладка
- Если при старте возникает ошибка `BOT_TOKEN not found in .env file`, убедитесь, что:
  - файл `.env` присутствует и содержит переменную `BOT_TOKEN`, или
  - переменная окружения `BOT_TOKEN` задана в среде запуска.
- Если бот не отвечает на отправку ссылок — проверьте логи консоли, корректность установленных пакетов и версию Python.
- Если цвета не применяются — убедитесь, что вы вводите корректный HEX (6 символов, с или без `#`).

---

## Docker (опционально)
В репозитории нет Dockerfile, но вы можете создать простой Dockerfile и собрать образ. Примерный процесс:
```dockerfile
FROM python:3.11-slim
WORKDIR /app
COPY . /app
RUN pip install --no-cache-dir -r requirements.txt
ENV BOT_TOKEN=your_token_here
CMD ["python", "main.py"]
```
Сборка и запуск:
```bash
docker build -t tg_qr_code_bot .
docker run -e BOT_TOKEN="${BOT_TOKEN}" tg_qr_code_bot
```

---

## Лицензия
В репозитории присутствует файл LICENSE с текстом Apache License 2.0. Используйте проект в соответствии с условиями этой лицензии.

---

## Контрибуция
PR и issues приветствуются. Рекомендации:
- Опишите цель изменения и шаги для воспроизведения/проверки.
- Для изменений, связанных с функционалом — добавьте тесты или инструкции.
- Для хранения настроек между перезапусками предложите реализацию через sqlite/Redis и опциональную настройку через переменные окружения.

---
